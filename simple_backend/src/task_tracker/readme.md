# Хранение состояния в проекте

**Хранение состояния** — это процесс сохранения и управления текущими данными, чтобы они были доступны между запросами, обновлениями или частями интерфейса.

В рамках проекта хранение состояния изначально происходит в списке `task_list`, в котором хранятся все созданные задачи, их `id` и статус.

---

## Минусы хранения состояния в оперативной памяти (списке Python)

- При таком подходе состояние (то есть наши задачи и данные по ним) хранятся **только до тех пор**, пока запущено наше приложение (например, локально через `uvicorn main:app`). После остановки сервера, изменении кода или, к примеру, сбое — **все данные будут удалены**.

- В случае развёртывания API **на нескольких серверах** — на каждом будет своя копия списка. Пользовательские данные могут попасть только на один из серверов, **синхронизации между ними не будет**.

- При использовании **многопоточности возможны конфликты**, так как потоки будут менять один и тот же список.

---

## Что улучшилось после перехода от списка к файлу проекта

- Задачи **сохраняются между сессиями** — данные записываются в файл, а не теряются при перезапуске.

- Даже при сбое сервера или аварийном завершении программы — **файл остаётся**, и задачи можно восстановить. Это повышает надёжность.

- **Файл доступен из разных экземпляров программы** (например, при масштабировании), если правильно реализовать блокировку доступа.

- Задачи теперь **независимы от кода**, что упрощает отладку, перенос, резервное копирование и потенциальную миграцию на другие системы хранения.

---

## Избавились ли мы от хранения состояния?

Нет, **хранение состояния осталось**, поскольку необходимо сохранять данные (наши задачи). Мы лишь **изменили способ хранения** — с хранения в оперативной памяти на хранение в `JSON`-файле.

---

## Дополнительные методы хранения состояния

### 1. SQL / NoSQL базы данных

**Плюсы:**
- Надёжность  
- Масштабируемость  
- Поддержка транзакций (данные записываются либо полностью, либо не записываются вовсе)

**Минусы:**
- Более сложная реализация  
- Необходимость дополнительной настройки

---

### 2. In-memory базы данных

**Плюсы:**
- Очень высокая скорость  
- Поддержка `expire` (автоудаление)

**Минусы:**
- Всё хранится в оперативной памяти  
- Потеря данных при сбое  
- Не подходит как основная БД

---

## Race condition: состояние гонки и проблемы текущей реализации

**Race condition** (состояние гонки) — это ситуация, при которой несколько потоков (или процессов) **одновременно пытаются выполнить операции** чтения или записи к общим ресурсам **без должной синхронизации**.

На текущем этапе:

- Наш бэкенд **может столкнуться с race condition**, если несколько пользователей или сервисов одновременно обратятся к файлу с задачами.
- В текущей реализации **отсутствует механизм синхронизации**, поэтому такие конфликты не предотвращаются.

**Возможные решения:**
- Настройка **механизмов блокировки**, разрешающих доступ к ресурсу только одному процессу одновременно.
- Переход от файлового хранения к **использованию базы данных**, где встроены **транзакции и блокировки**.


## Как запустить проект?
Для запуска локального сервиса необходимо воспользоваться командой `uvicorn main:app`.

## Примеры использования API

### Получить список задач

**Метод:** `GET`  
**URL:** `http://localhost:8000/tasks`

**Пример ответа:**
```json
[
  {
    "id": 1,
    "title": "Решить задачу A. Solution: [ответ модели]",
    "status": "New"
  },
  {
    "id": 2,
    "title": "Решить задачу B. Solution: [ответ модели]",
    "status": "In Progress"
  }
]
```

---

### Создать новую задачу

**Метод:** `POST`  
**URL:** `http://localhost:8000/tasks`

**Пример запроса (Body → raw → JSON):**
```json
{
  "title": "Как реализовать очередь задач?"
}
```

**Пример ответа:**
```json
{
  "message": "Таск создан"
}
```

---

### Обновить существующую задачу

**Метод:** `PUT`  
**URL:** `http://localhost:8000/tasks/{task_id}`  
*(Замените `{task_id}` на ID задачи)*

**Пример запроса:**
```json
{
  "title": "Как реализовать очередь задач в Python?",
  "status": "In Progress"
}
```

**Пример ответа:**
```json
{
  "message": "Таск обновлен"
}
```

**Если задача с указанным ID не найдена:**
```json
{
  "error": "Таск с таким id не найден"
}
```

---

### Удалить задачу

**Метод:** `DELETE`  
**URL:** `http://localhost:8000/tasks/{task_id}`  
*(Замените `{task_id}` на ID задачи)*

**Пример ответа:**
```json
{
  "message": "Таск удален"
}
```

**Если задача с указанным ID не найдена:**
```json
{
  "error": "Таск с таким id не найден"
}
```